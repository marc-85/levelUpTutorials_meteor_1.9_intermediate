"use strict";

var _expect = _interopRequireDefault(require("expect"));

var _SimpleSchema = require("./SimpleSchema");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/* eslint-disable func-names, prefer-arrow-callback */
describe('SimpleSchema - autoValueFunctions', function () {
  it('simple', function () {
    const schema = new _SimpleSchema.SimpleSchema({
      a: {
        type: String,

        autoValue() {}

      }
    });
    const autoValueFunctions = schema.autoValueFunctions();
    (0, _expect.default)(autoValueFunctions.length).toBe(1);
    (0, _expect.default)(!!autoValueFunctions[0].func).toBe(true);
    (0, _expect.default)(autoValueFunctions[0].fieldName).toBe('a');
    (0, _expect.default)(autoValueFunctions[0].closestSubschemaFieldName).toBe('');
  });
  it('one level of subschema', function () {
    const subschema = new _SimpleSchema.SimpleSchema({
      z: {
        type: Object,

        autoValue() {}

      }
    });
    const schema = new _SimpleSchema.SimpleSchema({
      a: {
        type: Object,

        autoValue() {}

      },
      'a.b': {
        type: String,

        autoValue() {}

      },
      c: {
        type: subschema
      }
    });
    const autoValueFunctions = schema.autoValueFunctions();
    (0, _expect.default)(autoValueFunctions.length).toBe(3);
    (0, _expect.default)(!!autoValueFunctions[0].func).toBe(true);
    (0, _expect.default)(autoValueFunctions[0].fieldName).toBe('a');
    (0, _expect.default)(autoValueFunctions[0].closestSubschemaFieldName).toBe('');
    (0, _expect.default)(!!autoValueFunctions[1].func).toBe(true);
    (0, _expect.default)(autoValueFunctions[1].fieldName).toBe('a.b');
    (0, _expect.default)(autoValueFunctions[1].closestSubschemaFieldName).toBe('');
    (0, _expect.default)(!!autoValueFunctions[2].func).toBe(true);
    (0, _expect.default)(autoValueFunctions[2].fieldName).toBe('c.z');
    (0, _expect.default)(autoValueFunctions[2].closestSubschemaFieldName).toBe('c');
  });
  it('two levels of subschemas', function () {
    const subschema1 = new _SimpleSchema.SimpleSchema({
      x: {
        type: Object,

        autoValue() {}

      },
      'x.m': {
        type: Array,

        autoValue() {}

      },
      'x.m.$': {
        type: String
      }
    });
    const subschema2 = new _SimpleSchema.SimpleSchema({
      z: {
        type: Object,

        autoValue() {}

      },
      'z.y': {
        type: subschema1
      }
    });
    const schema = new _SimpleSchema.SimpleSchema({
      a: {
        type: Object,

        autoValue() {}

      },
      'a.b': {
        type: String,

        autoValue() {}

      },
      c: {
        type: subschema2
      }
    });
    const autoValueFunctions = schema.autoValueFunctions();
    (0, _expect.default)(autoValueFunctions.length).toBe(5);
    (0, _expect.default)(!!autoValueFunctions[0].func).toBe(true);
    (0, _expect.default)(autoValueFunctions[0].fieldName).toBe('a');
    (0, _expect.default)(autoValueFunctions[0].closestSubschemaFieldName).toBe('');
    (0, _expect.default)(!!autoValueFunctions[1].func).toBe(true);
    (0, _expect.default)(autoValueFunctions[1].fieldName).toBe('a.b');
    (0, _expect.default)(autoValueFunctions[1].closestSubschemaFieldName).toBe('');
    (0, _expect.default)(!!autoValueFunctions[2].func).toBe(true);
    (0, _expect.default)(autoValueFunctions[2].fieldName).toBe('c.z');
    (0, _expect.default)(autoValueFunctions[2].closestSubschemaFieldName).toBe('c');
    (0, _expect.default)(!!autoValueFunctions[3].func).toBe(true);
    (0, _expect.default)(autoValueFunctions[3].fieldName).toBe('c.z.y.x');
    (0, _expect.default)(autoValueFunctions[3].closestSubschemaFieldName).toBe('c.z.y');
    (0, _expect.default)(!!autoValueFunctions[4].func).toBe(true);
    (0, _expect.default)(autoValueFunctions[4].fieldName).toBe('c.z.y.x.m');
    (0, _expect.default)(autoValueFunctions[4].closestSubschemaFieldName).toBe('c.z.y');
  });
  it('array of objects', function () {
    const subschema = new _SimpleSchema.SimpleSchema({
      z: {
        type: String,

        autoValue() {}

      }
    });
    const schema = new _SimpleSchema.SimpleSchema({
      a: {
        type: Object,

        autoValue() {}

      },
      'a.b': {
        type: Array
      },
      'a.b.$': {
        type: subschema
      }
    });
    const autoValueFunctions = schema.autoValueFunctions();
    (0, _expect.default)(autoValueFunctions.length).toBe(2);
    (0, _expect.default)(!!autoValueFunctions[0].func).toBe(true);
    (0, _expect.default)(autoValueFunctions[0].fieldName).toBe('a');
    (0, _expect.default)(autoValueFunctions[0].closestSubschemaFieldName).toBe('');
    (0, _expect.default)(!!autoValueFunctions[1].func).toBe(true);
    (0, _expect.default)(autoValueFunctions[1].fieldName).toBe('a.b.$.z');
    (0, _expect.default)(autoValueFunctions[1].closestSubschemaFieldName).toBe('a.b.$');
  });
});